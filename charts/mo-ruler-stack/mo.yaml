grafana:
  replicas: 1
  enabled: true
  adminUser: admin
  adminPassword: admin
  datasources: 
    datasources.yaml:
      apiVersion: 1
      datasources:
      - name: MO-OB-Control-Plane-Metrics
        type: prometheus
        url: http://mo-ruler-service.mo-ob:9199
        access: proxy
      - name: MO-Ruler-Control-Plane-Logs
        type: mysql
        # no http://
        url: mo-tp-cn.mo-ob:6001
        isDefault: true
        user: dump
        jsonData:
          database: mo_ob_logs
        secureJsonData:
          password: 111
      - name: MO-Ruler-Unit-01-Logs
        type: mysql
        # no http://
        url: freetier-01.cluster.dev.matrixone.tech:6001
        user: mocloud_mo_ob\:admin\:accountadmin
        jsonData:
          database: mo_ob_logs
        secureJsonData:
          password: 111
  service:
    enabled: true
    type: LoadBalancer
    port: 3000
    targetPort: 3000
    # targetPort: 4181 To be used with a proxy extraContainer
    ## Service annotations. Can be templated.
    annotations: {}
    labels: {}
    portName: service
    # Adds the appProtocol field to the service. This allows to work with istio protocol selection. Ex: "http" or "tcp"
    appProtocol: ""
  dashboardProviders: 
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
      - name: 'matrixone-cloud'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/matrixone-cloud
  dashboardsConfigMaps:
    matrixone-cloud: "grafana-dashboards"

alertmanager:
  replicaCount: 1
  enabled: true
  config:
    global: 
        resolve_timeout: 5m
        smtp_from: 'it@matrixorigin.cn'
        smtp_hello: 'smtp.exmail.qq.com:465'
        smtp_smarthost: 'smtp.exmail.qq.com:465'
        smtp_auth_username: 'it@matrixorigin.cn'
        smtp_auth_password_file: '/tmp/smtp-password/smtp-password'
        smtp_require_tls: false
    route:
        group_by: ['alertname']     # 分组标签
        group_wait: 10s             # 告警等待时间。告警产生后等待10s，如果有同组告警一起发出
        group_interval: 10s         # 两组告警的间隔时间
        repeat_interval: 1d         # 重复告警的间隔时间，可减少相同邮件的发送频率
        receiver: 'default-receiver'
    receivers:
      - name: default-receiver
        email_configs:
          - to: 'user@matrixorigin.cn'
            # send_resolved: true
  extraSecretMounts: 
  - name: smtp-files
    mountPath: /tmp/smtp-password
    subPath: ""
    secretName: alertmanager-secret
    readOnly: true

moRuler:
  containerName: mo-ruler
  replicaCount: 1
  image:
    repository: matrixorigin/observability
    tag: mo-ruler-0.7.0
    pullPolicy: Always
  apiServer:
    port: 9199

  resources:
    limits:
      cpu: 1000m
      memory: 1024Mi
    requests:
      cpu: 1000m
      memory: 1024Mi
    
  service:
    type: ClusterIP
    port: 9199
  
  rulerSpec:
    alerting:
      alertingEndpoint:
        scheme: http
        targets:
          - "mo-ruler-stack-alertmanager.<OB_NAMESPACE>:9093"
    log:
      level: debug
      format: console
      filename:
      maxSize:
      maxDays:
      maxBackups:
    ruler:
      rule:
        ruleType: metric
        notificationQueueCapacity: 10000
        outageTolerance: 1h
        forGracePeriod: 10m
        resendDelay: 1m
        metricConfigPath: /ruler-prometheus.yml
      mo:
        host: mo-tp-cn.<OB_NAMESPACE>
        port: 6001
        user: dump
        password: 111
        connectTimeout: 15s
        maxOpens: 5
        maxIdles: -1
        initPingCnt: 10
      query:
        maxQueryTimeout: 2m
        subQueryStepInterval: 1m
        lookBackDelta: 5m
        maxSamples: 50000000
        maxPointsPerTs: 11000
        database: mysql
        account: sys
      apiServer:
        lookBackDelta: 5m
        listenAddress: 0.0.0.0:9199
        readTimeout: 5m
        maxConnections: 512
        routePrefix: /
        consoleTemplatesPath: consoles
        consoleLibrariesPath: console_libraries
        enableLifecycle: false
        pageTitle: MO-Ruler Server
        appName: MO-Ruler
